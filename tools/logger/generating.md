# Generating log marshalers

Log marshalers can be automatically generated, similar to the stringer
example in [this blog post](https://blog.golang.org/generate).

Consider a `struct` like so:

```golang

type OrgInfo struct {
    Org string
    Guid string
}
```

## Field tags

To specify the field name to log these as, we first need to annotate
this:

```golang

type OrgInfo struct
    Org  string `log:"or.org.shortname"`
    Guid string `log:"or.org.guid"`
}

```

With the addition of the annotation (which matches the [standard
attributes](https://app.datadoghq.com/logs/pipelines/standard-attributes)),
we can use
[logger](https://github.com/getoutreach/gobox/tree/master/tools/logger)
to generate the `MarshalLog` method:

```bash

# run from directory where the OrgInfo struct is stored
$> go run github.com/getoutreach/gobox/tools/logger -output marshalers.go
$> cat marshalers.go
// Code generated by "logger -output marshalers.go"; DO NOT EDIT.

package log

func (s *OrgInfo) MarshalLog(addField func(key string, value interface{})) {
	if s == nil {
		return
	}
	addField(or.org.shortname, Org)
	addField(or.org.guid, Guid)
}
```

## Using go generate

Go `generate` is the standard way to generate pre-build artifacts
(which are checked in rather than made part of the circle-build).
Once the following line is added to **one go file** in a directory,
all structs which have `log:"..."` annotations will automatically have
their corresponding marshalers generated when `go generate` is run.

    //go:generate go run github.com/getoutreach/gobox/tools/logger -output marshalers.go

Note that `go generate` can be run from the root of the project via
`go generate ./...`.
